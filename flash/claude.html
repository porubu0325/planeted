<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Hub</title>

    <script src="./ruffle/ruffle.js"></script>
</head>
<body>
    <header>
        <h1>Flash Hub</h1>
        <nav id="menu">
            <button data-swf="homerun.swf">ホームラン競争</button>
            <button data-swf="win31esc.swf">タイピングゲーム</button>
            <button data-swf="puzzle.swf">パズル</button>
            <button data-swf="shooting.swf">シューティング</button>
        </nav>
    </header>

    <main>
        <div class="info">
            <p>いろんなFlashを集めてみました。<br>
            <a href="https://ruffle.rs" target="_blank">Ruffle</a>を使うことで再生ができます。<br>
            ※PC推奨です。問題があれば削除します</p>
        </div>

        <div id="flash-container">
            <div class="no-content">上のメニューからFlashを選択してください</div>
        </div>
    </main>

    <script>
        // URLパラメータの取得
        function getURLParameter(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        // URLパラメータの設定
        function setURLParameter(name, value) {
            const url = new URL(window.location);
            url.searchParams.set(name, value);
            window.history.pushState({}, '', url);
        }

        // Flashの読み込み
        function loadFlash(swfFile) {
            if (!swfFile) return;

            const container = document.getElementById('flash-container');
            container.innerHTML = '';

            const playerWrapper = document.createElement('div');
            playerWrapper.id = 'player-wrapper';
            container.appendChild(playerWrapper);

            const ruffle = window.RufflePlayer.newest();
            const player = ruffle.createPlayer();
            playerWrapper.appendChild(player);

            player.style.width = '100%';
            player.style.height = '100%';

            const swfUrl = `./swf/${swfFile}`;
            player.load(swfUrl);

            // アクティブなボタンの更新
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.swf === swfFile) {
                    btn.classList.add('active');
                }
            });

            // URLパラメータの更新
            setURLParameter('swf', swfFile);
        }

        // メニューボタンのイベントリスナー
        document.getElementById('menu').addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const swfFile = e.target.dataset.swf;
                loadFlash(swfFile);
            }
        });

        // ページ読み込み時の処理
        window.addEventListener('DOMContentLoaded', () => {
            const swfParam = getURLParameter('swf');
            if (swfParam) {
                loadFlash(swfParam);
            }
        });

        // ブラウザの戻る/進むボタン対応
        window.addEventListener('popstate', () => {
            const swfParam = getURLParameter('swf');
            if (swfParam) {
                loadFlash(swfParam);
            } else {
                document.getElementById('flash-container').innerHTML = 
                    '<div class="no-content">上のメニューからFlashを選択してください</div>';
                document.querySelectorAll('nav button').forEach(btn => {
                    btn.classList.remove('active');
                });
            }
        });
    </script>
</body>
</html>